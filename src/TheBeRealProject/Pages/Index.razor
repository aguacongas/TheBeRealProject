@page "/"
@inject HttpClient HttpClient
@inject ThemeService ThemeService

<PageTitle>The BeReal Project</PageTitle>


<div class="card bg-body-secondary">
    <div class="m-3">
        <div class="row">
            <div class="col" @onmouseout="e => SelectedIndex = null">
                <h1 class="text-uppercase h5">The <a href="https://bereal.com/">BeReal</a> Project</h1>
            </div>
            <div class="col-6">
                <div class="d-flex">
                    <div class="ms-2 mt-2 d-none d-md-block">
                        <SelectedTitle Assets="@Assets" SelectedIndex="SelectedIndex"></SelectedTitle>
                    </div>
                    <div class="dropdown ms-auto">
                        <buttong class="btn dropdown-toggle text-body-emphasis @Show" @onclick="ToggleShow">Theme</buttong>
                        <ul class="dropdown-menu dropdown-menu @Show">
                            <li><a class="dropdown-item" href="#" @onclick="SetDarkTheme">dark</a></li>
                            <li><a class="dropdown-item" href="#" @onclick="SetLightTheme">light</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="ms-md-3 mb-5">
        <div class="row">
            <div class="col-md" @onmouseout="HandleOnMouseOut">
                <ImageGrid Assets="@Assets" OnMouseOver="HandleMouseOver" OnClick="HandleClick"></ImageGrid>
            </div>
            <div class="col-md">
                <div class="d-md-none">
                    <SelectedTitle Assets="@Assets" SelectedIndex="SelectedIndex"></SelectedTitle>
                </div>
                <SelectedImage Assets="@Assets" SelectedIndex="SelectedIndex"></SelectedImage>
            </div>
        </div>
    </div>
</div>
@code
{
    AssetItem[]? Assets { get; set; }
    int? SelectedIndex { get; set; }
    string? Show { get; set; }

    bool UpdateSelectedIndexOnMouseOver = true;
    protected override async Task OnInitializedAsync() 
    {
        Assets = await HttpClient.GetFromJsonAsync<AssetItem[]>("assets.json").ConfigureAwait(false);
        await base.OnInitializedAsync().ConfigureAwait(false);
    }

    void HandleMouseOver(int index) 
    {
        if (UpdateSelectedIndexOnMouseOver) 
        {
            SelectedIndex = index;
        }
    }

    void HandleClick(int index) 
    {
        UpdateSelectedIndexOnMouseOver = !UpdateSelectedIndexOnMouseOver;
    }

    void HandleOnMouseOut()
    {
        if (UpdateSelectedIndexOnMouseOver) 
        {
            SelectedIndex = null;
        }
    }

    void ToggleShow()
    {
        if (Show is null)
        {
            Show = "show";
        }
        else
        {
            Show = null;
        }
    }

    async Task SetDarkTheme()
    {
        await ThemeService.SetThemeAsync("dark").ConfigureAwait(false);
        ToggleShow();
    }

    async Task SetLightTheme()
    {
        await ThemeService.SetThemeAsync("light").ConfigureAwait(false);
        ToggleShow();
    }
}
