@page "/"
@inject HttpClient HttpClient

<PageTitle>The BeReal Project</PageTitle>


<div class="card text-bg-dark">
    <div class="m-3">
        <div class="row">
            <div class="col" @onmouseout="e => SelectedIndex = null">
                <h1 class="text-uppercase h5">The <a href="https://bereal.com/">BeReal</a> Project</h1>
            </div>
            <div class="col-6">
                <SelectedTitle Assets="@Assets" SelectedIndex="SelectedIndex"></SelectedTitle>
            </div>
        </div>
    </div>
    <div class="ms-md-3 mb-5">
        <div class="row">
            <div class="col-md" @onmouseout="HandleOnMouseOut">
                <ImageGrid Assets="@Assets" OnMouseOver="HandleMouseOver" OnClick="HandleClick"></ImageGrid>
            </div>
            <div class="col-md">
                <SelectedImage Assets="@Assets" SelectedIndex="SelectedIndex"></SelectedImage>
            </div>
        </div>
    </div>
</div>
@code
{
    GitHubItem[]? Assets { get; set; }
    int? SelectedIndex { get; set; }

    bool UpdateSelectedIndexOnMouseOver = true;
    protected override async Task OnInitializedAsync() 
    {
        using var response = await HttpClient.GetAsync("contents/assets").ConfigureAwait(false);
        response.EnsureSuccessStatusCode();
        Assets = await response.Content.ReadFromJsonAsync<GitHubItem[]>().ConfigureAwait(false);
        await base.OnInitializedAsync().ConfigureAwait(false);
    }

    void HandleMouseOver(int index) 
    {
        if (UpdateSelectedIndexOnMouseOver) 
        {
            SelectedIndex = index;
        }
    }

    void HandleClick(int index) 
    {
        UpdateSelectedIndexOnMouseOver = !UpdateSelectedIndexOnMouseOver;
    }

    void HandleOnMouseOut()
    {
        if (UpdateSelectedIndexOnMouseOver) 
        {
            SelectedIndex = null;
        }
    }
}
